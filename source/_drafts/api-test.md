title: 接口调试——前后端分离的分娩之痛
tags: 
---

## 楔子
“你把代码提交一下，我更新一下试试”
。。。
“你再更新一下，看看可以了不？什么，结果没出来？连我这边试一下”
。。。
“擦，你这个参数值大小写错了”
这是经常在前后端调试的时候发生的对话。
## 趋势
web技术发展到了今天，全栈开发的模式逐渐被前后端分离的开发模式所取代。
从市场角度来说前端知识的快速增长，使得全栈开发人员需要掌握更多的技能和知识，也需要投入更多的精力。从而优秀的全栈变得更少，更难满足市场的需求。前后端分离让前端技术变得更专业化，也减轻后端开发压力。
从技术上来说，低耦合，模块化是代码开发的理想状态，前后端分离更有利于这一目标的实现，为以后的维护降低了成本。
从行业上来说，一般一个行业，发展越成熟，分工就越精细（js全栈也是我所看好的，用一种语言解决前后端开发，降低了开发人员门槛。有兴趣可以看一下这些优秀的项目[meteor](https://github.com/meteor/meteor)[meanjs](https://github.com/meanjs/mean)）。
## 问题
前后端分离似乎很美好，让前后端开发人员专注自己的技术和业务知识，但产品最终要上线，最终是要合在一起的，要保证前后端开发的代码能完美的契合，只能进行接口调试了。

- - -  
<!-- more -->

## 契约测试的可行性方案：

缩写：
前端 - FE（front end）
本地 - L（local）
测试 - T（test）
服务器 - S（server）
后端 - BE（back end）
接口 - API（application programming interface）
开发 - D（development）

            
    FE L S <——> FE T S <——> API S <——> BE T S <——> BE L S 
                                        ^
                                        |
                                         ——> BE D S

* （API S）接口服务器说明：
由前端主导，前后端在测试服务器上共同编写接口，主要提供接口数据的json定义和文字说明。
根据接口文档生成前端调试代码、数据和后端调试代码，分别部署于前端测试服务器和后端测试服务器。
如果出现接口修改等情况，重新生成接口文档和调试代码，并部署重启测试服务器

* （FE T S）前端测试服务器说明：
为前端提供假数据。类似通常调试用的xxx.get.html和xxx.json文件，它的地位有点像现在虎哥弄的158服务器，不过它不查询数据库，也不处理复杂的业务逻辑。只根据根据请求路径和参数来返回假数据。
校验前端请求参数。当前端参数不符合接口定义时，抛出异常。

* （BE T S）后端测试服务器说明：
发送请求给后端本地服务器。后端人员开发完成接口后，通过后端测试服务器操作，手动发送请求进行联调。
校验请求返回结果。当返回结果与接口定义不一致时抛出异常。
定时任务测试开发环境接口。确保开发环境的接口跟本地调试接口一致。

* 补充：
开始考虑用node.js代替现在client端，技术上是可行的，不过时间成本太大，风险较高。这一套方案的好处对现有的pc端架构基本不改动，只需要将服务器配置指向测试服务器即可。而测试服务器和接口服务器都是新增的，不会对已有项目产生影响。
避免了前后端接口调试的痛苦过程，开发人员只需和自己的测试服务器进行联调即可。在接口配置不变的情况下，与测试服务器的调试成功后，前后端部署代码即可保证与调试结果一致。
前端测试服务器用java的mock工具，后端测试服务器只包含一些测试代码，对本地开发环境进行手动测试，同时对开发环境进行定时测试，以防止代码更新等问题。接口服务器是关键，生成的代码必须保证前后端测试结果一致性，这里考虑用swagger生成。